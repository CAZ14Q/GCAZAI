<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>G CAZ AI | Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ù…Ø·ÙˆØ±Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
        }
        .nav-btn {
            background: #1e293b;
            border-bottom: 4px solid transparent;
            transition: all 0.3s;
        }
        .nav-btn.active {
            background: #f97316;
            border-bottom-color: #ea580c;
            color: white;
        }
        .chat-container {
            height: 55vh;
            background: #1e293b;
            border-radius: 15px;
        }
        .disclaimer-bar {
            background: linear-gradient(90deg, #7f1d1d, #b91c1c);
            border-radius: 10px;
        }
        .method-step {
            border-right: 4px solid #f97316;
            background: rgba(30, 41, 59, 0.5);
        }
        .custom-scroll::-webkit-scrollbar { width: 5px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>

<body class="p-2 md:p-6">
<!-- ÙƒÙ„ Ø§Ù„Ù€ HTML ÙƒÙ…Ø§ Ù‡Ùˆ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ ØªØºÙŠÙŠØ± -->
<!-- â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ -->
<!-- Ù„Ù… ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø£ÙŠ Ø´ÙŠØ¡ ÙÙˆÙ‚ -->

<script>
    function openTab(id) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.remove('hidden');
        document.getElementById(`tab-btn-${id}`).classList.add('active');
    }

    /* ğŸ”§ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø§Ù„ÙˆØ­ÙŠØ¯ Ù‡Ù†Ø§ */
    async function fetchAI(prompt, system) {
        try {
            const response = await fetch("/api/server", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    message: prompt,
                    system: system
                })
            });

            const data = await response.json();
            return data.reply || "Ù†Ø¹ØªØ°Ø±ØŒ Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";

        } catch (e) {
            return "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ.";
        }
    }

    async function sendMessage() {
        const input = document.getElementById('chat-input');
        const text = input.value.trim();
        if (!text) return;

        const box = document.getElementById('chat-messages');
        box.innerHTML += `<div class="p-4 text-sm self-end max-w-[90%] ml-auto bg-orange-600 rounded-2xl rounded-bl-none">${text}</div>`;
        input.value = "";
        box.scrollTop = box.scrollHeight;

        document.getElementById('loading-spinner').classList.remove('hidden');

        const sys = `You are G CAZ AI. Respond in Arabic. Analyze every case across: Internal Medicine, General Surgery, and Genomics. Follow a methodology: Assessment -> Cross-Reference -> Recommendation.`;

        const reply = await fetchAI(text, sys);

        document.getElementById('loading-spinner').classList.add('hidden');
        box.innerHTML += `<div class="message-ai p-4 text-sm max-w-[90%] bg-slate-700 rounded-2xl rounded-br-none leading-relaxed">${reply.replace(/\n/g, '<br>')}</div>`;
        box.scrollTop = box.scrollHeight;
    }

    async function searchLibrary() {
        const val = document.getElementById('lib-input').value.trim();
        if (!val) return;

        const res = document.getElementById('lib-results');
        res.classList.remove('hidden');
        res.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù„Ù…ÙŠØ©...`;

        const prompt = `Academic summary for: ${val}. Mention ClinVar, PubMed references. Arabic explanation, English citations.`;
        const result = await fetchAI(prompt, "Academic Librarian Mode.");
        res.innerHTML = result.replace(/\n/g, '<br>');
    }

    document.getElementById('ancestry-file').onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const res = document.getElementById('ancestry-results');
        res.classList.remove('hidden');
        res.innerHTML = `<i class="fas fa-dna fa-spin"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ±Ø¯Ø¯Ø§Øª Ø§Ù„Ø¬ÙŠÙ†ÙŠØ© ÙˆØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ù„Ø§Ù„Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©...`;

        const prompt = `Simulate an ethical ancestry report for ${file.name} in ARABIC. Breakdown geographic regions and explain historical migration paths. Mention data privacy.`;
        const result = await fetchAI(prompt, "Population Geneticist Mode.");
        res.innerHTML = result.replace(/\n/g, '<br>');
    };

    document.getElementById('vcf-file').onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const text = await file.text();
        const lines = text.split('\n').filter(l => !l.startsWith('#') && l.trim()).slice(0, 10);

        document.getElementById('vcf-table-area').classList.remove('hidden');
        const tbody = document.getElementById('vcf-rows');

        tbody.innerHTML = lines.map(l => {
            const p = l.split('\t');
            return `<tr>
                <td class="p-4 text-slate-500">Chr${p[0]}:${p[1]}</td>
                <td class="p-4 font-bold text-orange-500 uppercase">Gene_Analysis</td>
                <td class="p-4"><span class="bg-orange-500/10 text-orange-500 px-2 py-1 rounded">Moderate</span></td>
                <td class="p-4"><button class="text-blue-400 hover:underline">Full Report</button></td>
            </tr>`;
        }).join('');
    };
</script>

</body>
</html>
